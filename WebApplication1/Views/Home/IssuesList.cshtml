@model IEnumerable<Jira.Views.Dto.IssueListModel>
@{
    ViewBag.Title = "운영이슈";
}
@{
    var TotalRows = Jira.Views.Dto.IssueListModel.TotalRows;
    var TotalPage = 0;
}
@if ((TotalRows % 10) != 0)
{
    TotalPage = TotalRows / 10 + 1;
}
else
{
    TotalPage = TotalRows / 10;
}
<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
<script>
    $(document).ready(function () {
        // Page Controller
        SetPageController(1, 10);

        // Register click event handler
        $(".pagination").on("click", "li", pageNumberClickHandler);

        // Chnage mouse cursor to wait while ajax loading
        $('body').ajaxStart(function () {
            $(this).css({ 'cursor': 'wait' })
        }).ajaxStop(function () {
            $(this).css({ 'cursor': 'default' })
        });

        // DatePicker
        $("#InputFrom").datepicker();
        $("#InputTo").datepicker();

        // For 6 month only.
        var today = new Date();
        var to = $.datepicker.formatDate('mm/dd/yy', today);
        var from = $.datepicker.formatDate('mm/dd/yy', new Date().addMonths(-6));
        $("#InputFrom").val(from);
        $("#InputTo").val(to);

        // Active 운영이슈 Tab
        $("#issueTableTab").addClass("active");
    });

    // 오늘 현재 부터 6개월 전 데이터를 불러오기위한 Date function
    Date.prototype.addMonths = function (n) {
        this.setMonth(this.getMonth() + n);
        return this;
    }

    function SetPageController(from, to) {
        if (to >= Number(@TotalPage)) {
            to = Number(@TotalPage);
        }
        var pageNumber = '<li id="leftPageClick"><a href="#">&laquo;</a></li>';
        for (var i = from; i <= to; i++) {
            pageNumber += ('<li><a href="#">' + i + '</a></li>');
        }
        $('.pagination').empty().append(pageNumber + '<li id="rightPageClick"><a href="#">&raquo;</a></li>').clone();
        $('.pagination .active').removeClass('active');
        $(".pagination :nth-child(2)").addClass("active")
    }


    function pageNumberClickHandler(event) {
        var pageNumber;

        if ($(this).attr('id') == 'leftPageClick') {
            var firstNumber = parseInt($(".pagination :nth-child(2)").text());
            if (firstNumber != 1) {
                var from = firstNumber - 10;
                var to = firstNumber - 1;
                SetPageController(from, to);
                pageNumber = from;
            } else {
                return;
            }
        }
        else if ($(this).attr('id') == 'rightPageClick') {
            var firstNumber = parseInt($(".pagination :nth-child(2)").text());
            var from = firstNumber + 10;
            if (from < Number(@TotalPage)) {
                var to = from + 9;
                if (to >= Number(@TotalPage)) {
                    to = Number(@TotalPage);
                }
                SetPageController(from, to);
                pageNumber = from;
            } else {
                return;
            }
        } else {
            pageNumber = parseInt($(this.childNodes).text());
            $('.pagination .active').removeClass('active');
            $(this).addClass("active");
        }

        //ajax call
        $.ajax({
            url: '@Url.Action("GetIssueList", "Home")',
            data: { pageNumber: pageNumber, pageRows: '10' },
            type: 'GET',
            success: function (data) {
                $('#issueListTable').empty().append(data).clone();
                $('#p_' + pageNumber).addClass("active");
            },
            error: function () {
                alert("Internal Error");
            }
        });
    }
</script>

<h2>운영이슈</h2>

<hr />

<div class="row">
    <div class="col-md-7">
        <form class="form-inline">
            <div class="form-group">
                <label class="sr-only" for="InputFrom">Email address</label>
                <input class="form-control" id="InputFrom" placeholder="From">
            </div>
            <div class="form-group">
                <label class="sr-only" for="InputTo">Password</label>
                <input class="form-control" id="InputTo" placeholder="To">
            </div>
            <button id="searchTableBtn" type="button" class="btn btn-default">검색</button>
            <!-- Button trigger modal -->
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#register">
                등록
            </button>
        </form>
    </div>
</div>

<div id="createIssueModal">
    @Html.Partial("_CreateIssueModal", ViewData["IssueListModel"])
</div>

<br />

<div id="issueListTable">
    @Html.Partial("_IssueListTable", Model)
</div>
<ul class="pagination"></ul>

