@model IEnumerable<Jira.Views.Dto.IssueListModel>
@{
    ViewBag.Title = "운영이슈";
}
@{
    var TotalRows = Jira.Views.Dto.IssueListModel.TotalRows;
    var TotalPage = 0;
}
@if ((TotalRows % 10) != 0)
{
    TotalPage = TotalRows / 10 + 1;
}
else
{
    TotalPage = TotalRows / 10;
}
<style>
    .buttonBox {
        position: absolute;
        bottom: 0;
        right: 0;
    }
</style>
<script>
    $(document).ready(function () {
        // Page Controller
        SetPageController(1, 10);

        // Register click event handler
        $(".pagination").on("click", "li", pageNumberClickHandler);

        // Chnage mouse cursor to wait while ajax loading
        $('body').ajaxStart(function () {
            $(this).css({ 'cursor': 'wait' })
        }).ajaxStop(function () {
            $(this).css({ 'cursor': 'default' })
        });
    });

    function SetPageController(from, to) {
        if (to >= Number(@TotalPage)) {
            to = Number(@TotalPage);
        }
        var pageNumber = '<li id="leftPageClick"><a href="#">&laquo;</a></li>';
        for (var i = from; i <= to; i++) {
            pageNumber += ('<li><a href="#">' + i + '</a></li>');
        }
        $('.pagination').empty().append(pageNumber + '<li id="rightPageClick"><a href="#">&raquo;</a></li>').clone();
        $('.active').removeClass('active');
        $(".pagination :nth-child(2)").addClass("active")
    }


    function pageNumberClickHandler(event) {
        var pageNumber;

        if ($(this).attr('id') == 'leftPageClick') {
            var firstNumber = parseInt($(".pagination :nth-child(2)").text());
            if (firstNumber != 1) {
                var from = firstNumber - 10;
                var to = firstNumber - 1;
                SetPageController(from, to);
                pageNumber = from;
            } else {
                return;
            }
        }
        else if ($(this).attr('id') == 'rightPageClick') {
            var firstNumber = parseInt($(".pagination :nth-child(2)").text());
            var from = firstNumber + 10;
            if (from < Number(@TotalPage)) {
                var to = from + 9;
                if (to >= Number(@TotalPage)) {
                    to = Number(@TotalPage);
                }
                SetPageController(from, to);
                pageNumber = from;
            } else {
                return;
            }
        } else {
            pageNumber = parseInt($(this.childNodes).text());
            $('.active').removeClass('active');
            $(this).addClass("active");
        }

        //ajax call
        $.ajax({
            url: '@Url.Action("GetIssueList", "Home")',
            data: { pageNumber: pageNumber, pageRows: '10' },
            type: 'GET',
            success: function (data) {
                $('#issueListTable').empty().append(data).clone();
                $('#p_' + pageNumber).addClass("active");
            },
            error: function () {
                alert("Internal Error");
            }
        });
    }
</script>

<div class="row">
    <div class="col-md-2"><h2>운영이슈</h2></div>
    <div class="col-md-1 buttonBox"><button id="createIssue" type="button" class="btn btn-default">이슈 등록</button></div>
</div>

<hr />
<div id="issueListTable">
    @Html.Partial("_IssueListTable", Model)
</div>
<ul class="pagination"></ul>

